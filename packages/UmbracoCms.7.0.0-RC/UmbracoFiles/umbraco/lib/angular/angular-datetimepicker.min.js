angular.module("ui.bootstrap.datetimepicker",[])
	.constant("dateTimePickerConfig",{startView:"day",minView:"minute",minuteStep:5,dropdownSelector:null}).directive("datetimepicker",["dateTimePickerConfig",function(e){"use strict";return{restrict:"E",require:"ngModel",template:"<div class='datetimepicker'>"+"<table class='table-condensed'>"+"   <thead>"+"       <tr>"+"           <th class='left'><i class='icon-arrow-left'/></th>"+"           <th class='switch' colspan='5'>{{ data.title }}</th>"+"           <th class='right'><i class='icon-arrow-right'/></th>"+"       </tr>"+"       <tr>"+"           <th class='dow' data-ng-repeat='day in data.dayNames' >{{ day }}</th>"+"       </tr>"+"   </thead>"+"   <tbody>"+"       <tr data-ng-class='{ hide: data.currentView == \"day\" }' >"+"           <td colspan='7' >"+"              <span    class='{{ data.currentView }}' "+"                       data-ng-repeat='dateValue in data.dates'  "+"                       data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}' "+"                       data-ng-click=\"changeView('{{ data.nextView }}', {{ dateValue.date }}, $event)\">{{ dateValue.display }}</span> "+"           </td>"+"       </tr>"+"       <tr data-ng-show='{{ data.currentView == \"day\" }}' data-ng-repeat='week in data.weeks'>"+"           <td data-ng-repeat='dateValue in week.dates' "+"               data-ng-click=\"changeView('{{ data.nextView }}', {{ dateValue.date }}, $event)\""+"               class='day' "+"               data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}' >{{ dateValue.display }}</td>"+"       </tr>"+"   </tbody>"+"</table></div>",scope:{ngModel:"=ngModel"},replace:true,link:function(t,n,r,i){var s={};if(r.datetimepickerConfig){s=t.$eval(r.datetimepickerConfig)}var o={};angular.extend(o,e,s);var u={year:function(e){var n=moment.utc(e).startOf("year");var r=parseInt(n.year()/10,10)*10;var i=moment.utc(n).year(r-1).startOf("year");var s=t.ngModel?moment(t.ngModel).year():0;var u={currentView:"year",nextView:o.minView==="year"?"setTime":"month",title:r+"-"+(r+9),leftDate:moment.utc(i).subtract(9,"year").valueOf(),rightDate:moment.utc(i).add(11,"year").valueOf(),dates:[]};for(var a=0;a<12;a++){var f=moment.utc(i).add(a,"years");var l={date:f.valueOf(),display:f.format("YYYY"),past:f.year()<r,future:f.year()>r+9,active:f.year()===s};u.dates.push(l)}return u},month:function(e){var n=moment.utc(e).startOf("year");var r=t.ngModel?moment(t.ngModel).format("YYYY-MMM"):0;var i={previousView:"year",currentView:"month",nextView:o.minView==="month"?"setTime":"day",currentDate:n.valueOf(),title:n.format("YYYY"),leftDate:moment.utc(n).subtract(1,"year").valueOf(),rightDate:moment.utc(n).add(1,"year").valueOf(),dates:[]};for(var s=0;s<12;s++){var u=moment.utc(n).add(s,"months");var a={date:u.valueOf(),display:u.format("MMM"),active:u.format("YYYY-MMM")===r};i.dates.push(a)}return i},day:function(e){var n=moment.utc(e);var r=moment.utc(n).startOf("month");var i=moment.utc(n).endOf("month");var s=moment.utc(r).subtract(r.day(),"days");var u=t.ngModel?moment(t.ngModel).format("YYYY-MMM-DD"):"";var a={previousView:"month",currentView:"day",nextView:o.minView==="day"?"setTime":"hour",currentDate:n.valueOf(),title:n.format("YYYY-MMM"),leftDate:moment.utc(r).subtract(1,"months").valueOf(),rightDate:moment.utc(r).add(1,"months").valueOf(),dayNames:[],weeks:[]};for(var f=0;f<7;f++){a.dayNames.push(moment.utc().day(f).format("dd"))}for(var l=0;l<6;l++){var c={dates:[]};for(var h=0;h<7;h++){var p=moment.utc(s).add(l*7+h,"days");var d={date:p.valueOf(),display:p.format("D"),active:p.format("YYYY-MMM-DD")===u,past:p.isBefore(r),future:p.isAfter(i)};c.dates.push(d)}a.weeks.push(c)}return a},hour:function(e){var n=moment.utc(e).hour(0).minute(0).second(0);var r=t.ngModel?moment(t.ngModel).format("YYYY-MM-DD H"):"";var i={previousView:"day",currentView:"hour",nextView:o.minView==="hour"?"setTime":"minute",currentDate:n.valueOf(),title:n.format("YYYY-MMM-DD"),leftDate:moment.utc(n).subtract(1,"days").valueOf(),rightDate:moment.utc(n).add(1,"days").valueOf(),dates:[]};for(var s=0;s<24;s++){var u=moment.utc(n).add(s,"hours");var a={date:u.valueOf(),display:u.format("H:00"),active:u.format("YYYY-MM-DD H")===r};i.dates.push(a)}return i},minute:function(e){var n=moment.utc(e).minute(0).second(0);var r=t.ngModel?moment(t.ngModel).format("YYYY-MM-DD H:mm"):"";var i={previousView:"hour",currentView:"minute",nextView:"setTime",currentDate:n.valueOf(),title:n.format("YYYY-MMM-DD H:mm"),leftDate:moment.utc(n).subtract(1,"hours").valueOf(),rightDate:moment.utc(n).add(1,"hours").valueOf(),dates:[]};var s=60/o.minuteStep;for(var u=0;u<s;u++){var a=moment.utc(n).add(u*o.minuteStep,"minute");var f={date:a.valueOf(),display:a.format("H:mm"),active:a.format("YYYY-MM-DD H:mm")===r};i.dates.push(f)}return i},setTime:function(e){var n=new Date(e);t.ngModel=new Date(n.getTime()+n.getTimezoneOffset()*6e4);if(o.dropdownSelector){jQuery(o.dropdownSelector).dropdown("toggle")}return u[t.data.currentView](e)}};var a=function(e){t.changeView(t.data[e.data.viewProperty],t.data[e.data.dateProperty],e);t.$apply()};jQuery(".left",n).on("click",{viewProperty:"currentView",dateProperty:"leftDate"},a);jQuery(".switch",n).on("click",{viewProperty:"previousView",dateProperty:"currentDate"},a);jQuery(".right",n).on("click",{viewProperty:"currentView",dateProperty:"rightDate"},a);var f=function(){var e=t.ngModel||new Date;return e.getTime()-e.getTimezoneOffset()*6e4};t.changeView=function(e,n,r){if(r){r.stopPropagation();r.preventDefault()}if(e&&n&&u[e]){t.data=u[e](n)}};t.$watch("ngModel",function(e){t.changeView(t.data.currentView,f())});t.changeView(o.startView,f())}}}])